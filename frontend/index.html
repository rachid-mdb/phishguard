<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>PhishGuard – Analyse de phishing</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">PhishGuard – Détection de phishing</h1>

    <!-- Formulaire d'analyse -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Analyser un email / une URL</h5>

        <form id="analyseForm">
          <div class="mb-3">
            <label class="form-label">Sujet de l'email</label>
            <input type="text" class="form-control" id="subject" placeholder="Ex: Urgent: vérifiez votre compte">
          </div>

          <div class="mb-3">
            <label class="form-label">Corps de l'email</label>
            <textarea class="form-control" id="body" rows="5"
              placeholder="Collez ici le contenu de l'email..."></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">URL (optionnelle)</label>
            <input type="text" class="form-control" id="url" placeholder="Ex: http://192.168.1.10/login.php">
          </div>

          <button type="submit" class="btn btn-primary">Analyser</button>
          <!-- On mettra plus tard un lien vers dashboard.html -->
          <!-- <a href="dashboard.html" class="btn btn-outline-secondary ms-2">Voir le Dashboard</a> -->
        </form>
      </div>
    </div>

    <!-- Résultat -->
    <div id="resultCard" class="card d-none">
      <div class="card-body">
        <h5 class="card-title">Résultat de l'analyse</h5>
        <p id="verdict" class="fw-bold"></p>
        <p id="probability"></p>
        <h6>Explications :</h6>
        <ul id="features"></ul>
        <p class="text-muted mb-0" id="logId"></p>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (optionnel, pour certains composants) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script de connexion à l'API -->
  <script>
    const API_BASE = "http://127.0.0.1:8000";  // ton backend FastAPI

    const form = document.getElementById("analyseForm");
    const resultCard = document.getElementById("resultCard");
    const verdictEl = document.getElementById("verdict");
    const probabilityEl = document.getElementById("probability");
    const featuresEl = document.getElementById("features");
    const logIdEl = document.getElementById("logId");

    form.addEventListener("submit", async (event) => {
      event.preventDefault(); // empêche le rechargement de la page

      const subject = document.getElementById("subject").value;
      const body = document.getElementById("body").value;
      const url = document.getElementById("url").value;

      // Construction du payload
      const payload = {
        subject: subject,
        body: body,
        url: url
      };

      try {
        const response = await fetch(`${API_BASE}/api/detect`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          alert("Erreur API : " + response.status);
          return;
        }

        const data = await response.json();

        // Affichage du résultat
        verdictEl.textContent = "Verdict : " + data.verdict.toUpperCase();
        probabilityEl.textContent = "Probabilité de phishing : " +
          (data.probability * 100).toFixed(1) + " %";

        // Liste des features
        featuresEl.innerHTML = "";
        (data.features || []).forEach(f => {
          const li = document.createElement("li");
          li.textContent = f;
          featuresEl.appendChild(li);
        });

        logIdEl.textContent = "Log ID : " + data.log_id;

        resultCard.classList.remove("d-none");
      } catch (err) {
        console.error(err);
        alert("Erreur lors de l'appel à l'API. Regarde la console pour plus de détails.");
      }
    });
  </script>
</body>
</html>
